<p id="notice"><%= notice %></p>
<%=link_to "Global Data", continents_path %> | <%=link_to "World Map", "javascript:drawRegionsMap()"%> | <%=link_to "Africa", "javascript:drawRegionsMap('002')"%> | 
<%=link_to "Asia", "javascript:drawRegionsMap('142')"%> | <%=link_to "Australia", "javascript:drawRegionsMap('009')"%> | <%=link_to "Europe", "javascript:drawRegionsMap('150')"%> | 
<%=link_to "North America", "javascript:drawRegionsMap('021')"%> | <%=link_to "South America", "javascript:drawRegionsMap('005')"%>

<head>
    <!-- We use this javascript to reload the page once, as only then the data gets fetched properly.
    If we would have had more time a more robust fix would be implemented. -->
    <script type="text/javascript">
      if(window.location.href.substr(-2) !== "?r") {
        window.location = window.location.href + "?r";
      }
    </script>

    
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {
        'packages':['geochart'],'mapsApiKey': 'AIzaSyDIQFAz4aYXsAg6IMs6l2Fj6aiXv_3uT2M'
      });
      google.charts.setOnLoadCallback(drawRegionsMap);
      var countrydata = JSON.parse('<%= @countrydata %>'.replace(/&quot;/g,'"'));

      function drawRegionsMap(regionID) {
        var data = google.visualization.arrayToDataTable(countrydata);
        var options = {};
        if (typeof(regionID) !== 'undefined') {
          var options = {
            region: regionID
          };
        }
        
        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        chart.draw(data, options);
      }
    </script>
</head>
<body>
    <div id="regions_div" style="width: 900px; height: 500px;"></div>
</body>